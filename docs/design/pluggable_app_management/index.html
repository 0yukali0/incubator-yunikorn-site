<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<title data-react-helmet="true">Pluggable App Management | Apache YuniKorn</title><meta data-react-helmet="true" name="docsearch:version" content="0.8.0"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Pluggable App Management | Apache YuniKorn"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><meta data-react-helmet="true" property="og:url" content="http://yunikorn.apache.org/docs/design/pluggable_app_management"><link data-react-helmet="true" rel="shortcut icon" href="/img/yunikorn.ico"><link data-react-helmet="true" rel="canonical" href="http://yunikorn.apache.org/docs/design/pluggable_app_management"><link rel="stylesheet" href="/styles.48727e9b.css">
<link rel="preload" href="/styles.957e58f8.js" as="script">
<link rel="preload" href="/runtime~main.87377b69.js" as="script">
<link rel="preload" href="/main.bcc5aa1b.js" as="script">
<link rel="preload" href="/1.32497331.js" as="script">
<link rel="preload" href="/2.ecf8b154.js" as="script">
<link rel="preload" href="/3.82db307e.js" as="script">
<link rel="preload" href="/1be78505.1e00729c.js" as="script">
<link rel="preload" href="/78.ec6dfba6.js" as="script">
<link rel="preload" href="/20ac7829.be731001.js" as="script">
<link rel="preload" href="/17896441.aa30516a.js" as="script">
<link rel="preload" href="/830bde22.82e9db10.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Quick Start</a><a class="navbar__item navbar__link" href="/community/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/community/download">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/apache">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/how_to_contribute">How To Contribute</a></li><li><a class="dropdown__link" href="/community/coding_guidelines">Coding Guidelines</a></li><li><a class="dropdown__link" href="/community/reporting_issues">Reporting Issues</a></li><li><a class="dropdown__link" href="/community/community_sync_up">Community Syncup</a></li><li><a class="dropdown__link" href="/community/sessions">Sessions and Demos</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/apache">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache Software Foundation</a></li><li><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache Incubator</a></li><li><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache License</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/">Master</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/">0.8.0</a></li></ul></div><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" href="/community/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/community/download">Download</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="/apache">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/community/how_to_contribute">How To Contribute</a></li><li class="menu__list-item"><a class="menu__link" href="/community/coding_guidelines">Coding Guidelines</a></li><li class="menu__list-item"><a class="menu__link" href="/community/reporting_issues">Reporting Issues</a></li><li class="menu__list-item"><a class="menu__link" href="/community/community_sync_up">Community Syncup</a></li><li class="menu__list-item"><a class="menu__link" href="/community/sessions">Sessions and Demos</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="/apache">Apache</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link">Apache Software Foundation</a></li><li class="menu__list-item"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link">Apache Incubator</a></li><li class="menu__list-item"><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="menu__link">Apache License</a></li><li class="menu__list-item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="menu__link">Sponsorship</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" href="/docs">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/">Master</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/">0.8.0</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Get Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">User Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/get_started/developer_guide">Developer Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/build_local">Build Local</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/configure_scheduler">Configure Scheduler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/deployment">Deployment Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/env_setup">Environment Setup</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/configuration/queue_config">Queue Config</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/configuration/placement_rules">Placement Rules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/configuration/acls">Acls</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Performance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/evaluate_perf_function_with_kubemark">Perf With Kubemark</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/profiling">Profiling</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Design</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/design">Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/cross_queue_preemption">Cross Queue Preemption</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/namespace_resource_quota">Namespace Resource Quota</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/design/pluggable_app_management">Pluggable App Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/resilience">Resilience</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/scheduler_configuration">Scheduler Configuration</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><div><span class="badge badge--secondary">Version: 0.8.0</span></div><header><h1 class="docTitle_1vWb">Pluggable App Management</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="pluggable-app-management"></a>Pluggable App Management<a aria-hidden="true" tabindex="-1" class="hash-link" href="#pluggable-app-management" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="the-problem"></a>The Problem<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-problem" title="Direct link to heading">#</a></h2><p>Currently, we schedule and group an application is based on a label on the pod.
This generic way works for any type of workload. It does however give us a limited information on the lifecycle
and application. On the K8s side, operators have been introduced to provide more detail on the application
and help scheduling. We cannot use them currently and want to add that functionality.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="k8s-operator-pattern"></a>K8s Operator Pattern<a aria-hidden="true" tabindex="-1" class="hash-link" href="#k8s-operator-pattern" title="Direct link to heading">#</a></h2><p><a href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/" target="_blank" rel="noopener noreferrer">K8s operator</a>
is a pattern in K8s to manage applications, it&#x27;s a handy way to manage application&#x27;s lifecycle out-of-box on K8s.
You define several CRDs and some controllers to monitor and mutate the state of the application based on the CRD definition.</p><p>For example in <a href="https://github.com/GoogleCloudPlatform/spark-on-k8s-operator" target="_blank" rel="noopener noreferrer">spark-k8s-operator</a>,
it defines a CRD called <code>SparkApplication</code>, the controller watches the events of add/update/delete of this CRD
and trigger corresponding actions on event notifications. The <code>SparkApplication</code> looks like
<a href="https://github.com/GoogleCloudPlatform/spark-on-k8s-operator/blob/master/examples/spark-pi.yaml">this example</a>. There
are a lot more popular operators, such as <a href="https://github.com/GoogleCloudPlatform/flink-on-k8s-operator" target="_blank" rel="noopener noreferrer">flink-k8s-operator</a>,
<a href="https://github.com/kubeflow/tf-operator" target="_blank" rel="noopener noreferrer">tf-operator</a>, <a href="https://github.com/kubeflow/pytorch-operator" target="_blank" rel="noopener noreferrer">pytorch-operator</a>, etc. </p><p>Use Spark as an example. YuniKorn is able to schedule resources for all pods in K8s, that seamlessly supports Spark. It
works with <a href="https://spark.apache.org/docs/latest/running-on-kubernetes.html">native Spark on K8s</a>, or
<a href="https://github.com/GoogleCloudPlatform/spark-on-k8s-operator/blob/master/docs/design.md#architecture">spark on K8s with operator</a>,
you&#x27;ll find the difference from the design architecture chart from the given link. To support native Spark on K8s,
YuniKorn reads pods&#x27; spec and group Spark pods by a label-selector, based on <code>spark-app-selector</code>.
The operator approach gives us more context about the Spark job, such as a better understanding about job state.
But all these info requires us to look at <code>SparkApplication</code> CRD, currently, there is no neat way to
add such functionality. That&#x27;s why we need to design a flexible approach to support 3rd party operators
(retrieving info from their CRDs), so we can easily integrate with other operators with small effort.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="design"></a>Design<a aria-hidden="true" tabindex="-1" class="hash-link" href="#design" title="Direct link to heading">#</a></h2><p>The key issue here is we need a app-management interface, that can be easily extended.
It needs to be decoupled with existing scheduling logic. For each operator, we create a service to manage this type app&#x27;s lifecycle,
and communicate with the scheduling cache independently. The high-level design looks like below:</p><p><img src="/img/pluggable-app-mgmt.jpg" alt="Pluggable App Management"></p><p>Where</p><ul><li><code>AppManagementService</code> is a composite set of services that can be managed together.</li><li><code>AppManager</code> is a specific app management service for a particular type of application. In each service, it has
access to K8s clients, such as informers, listers, in order to monitor CRD events. And it collects necessary info
and talk with scheduler cache through <code>AMProtocol</code>.</li><li><code>APIProvider</code> encapsulate a set of useful APIs that can be shared, such as kube-client, pod/node/storage informers, etc.
Each of such informers, it can be shared with multiple app managers, to avoid the overhead.</li><li><code>AMProtocol</code> defines the basic interaction contract between app manager and the scheduler cache, that helps the cache
to performs app lifecycle management without understanding what type of the application it is.</li></ul><p>In the upon chart, the AppManagementService has 2 services, the <em>general</em> one is managing normal applications, that
recognizes applications by pod labels; the <em>spark-k8s-operator</em> one watches <code>SparkApplication</code> CRD and manage jobs&#x27;
lifecycle defined by this CRD.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/design/namespace_resource_quota"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Namespace Resource Quota</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/design/resilience"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Resilience »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-problem" class="table-of-contents__link">The Problem</a></li><li><a href="#k8s-operator-pattern" class="table-of-contents__link">K8s Operator Pattern</a></li><li><a href="#design" class="table-of-contents__link">Design</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Blog</h4><ul class="footer__items"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s YuniKorn?</a></li><li class="footer__item"><a href="https://blog.cloudera.com/apache-yunikorn-incubating-0-8-release-whats-new-and-upcoming/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s new in YuniKorn 0.8.0?</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Github</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-core</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item">kubernetes-shim</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-interface</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-web</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="http://yunikorn.apache.org/community/community_sync_up" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community meetings</a></li><li class="footer__item"><a href="http://people.apache.org/phonebook.html?podling=yunikorn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roster</a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1Wg7"><img class="footer__logo" alt="Apache Incubator Logo" src="https://incubator.apache.org/images/apache-incubator-logo-source.svg"></a></div><div>Copyright © 2020 The Apache Software Foundation.</div></div></div></footer></div>
<script src="/styles.957e58f8.js"></script>
<script src="/runtime~main.87377b69.js"></script>
<script src="/main.bcc5aa1b.js"></script>
<script src="/1.32497331.js"></script>
<script src="/2.ecf8b154.js"></script>
<script src="/3.82db307e.js"></script>
<script src="/1be78505.1e00729c.js"></script>
<script src="/78.ec6dfba6.js"></script>
<script src="/20ac7829.be731001.js"></script>
<script src="/17896441.aa30516a.js"></script>
<script src="/830bde22.82e9db10.js"></script>
</body>
</html>