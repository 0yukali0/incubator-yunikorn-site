<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<title data-react-helmet="true">Architecture | Apache YuniKorn</title><meta data-react-helmet="true" name="docsearch:version" content="next"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Architecture | Apache YuniKorn"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><meta data-react-helmet="true" property="og:url" content="http://yunikorn.apache.org/docs/next/design/architecture"><link data-react-helmet="true" rel="shortcut icon" href="/img/yunikorn.ico"><link data-react-helmet="true" rel="canonical" href="http://yunikorn.apache.org/docs/next/design/architecture"><link rel="stylesheet" href="/styles.48727e9b.css">
<link rel="preload" href="/styles.957e58f8.js" as="script">
<link rel="preload" href="/runtime~main.53125f3e.js" as="script">
<link rel="preload" href="/main.43dd4139.js" as="script">
<link rel="preload" href="/1.32497331.js" as="script">
<link rel="preload" href="/2.ecf8b154.js" as="script">
<link rel="preload" href="/3.82db307e.js" as="script">
<link rel="preload" href="/1be78505.1e00729c.js" as="script">
<link rel="preload" href="/78.ec6dfba6.js" as="script">
<link rel="preload" href="/c6c6e257.77e2123c.js" as="script">
<link rel="preload" href="/17896441.aa30516a.js" as="script">
<link rel="preload" href="/64a11ff0.7384874c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Quick Start</a><a class="navbar__item navbar__link" href="/community/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/community/download">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/apache">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/how_to_contribute">How To Contribute</a></li><li><a class="dropdown__link" href="/community/coding_guidelines">Coding Guidelines</a></li><li><a class="dropdown__link" href="/community/reporting_issues">Reporting Issues</a></li><li><a class="dropdown__link" href="/community/community_sync_up">Community Syncup</a></li><li><a class="dropdown__link" href="/community/sessions">Sessions and Demos</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/apache">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache Software Foundation</a></li><li><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache Incubator</a></li><li><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache License</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next/">Master</a></li><li><a class="dropdown__link" href="/docs/">0.8.0</a></li></ul></div><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" href="/community/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/community/download">Download</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="/apache">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/community/how_to_contribute">How To Contribute</a></li><li class="menu__list-item"><a class="menu__link" href="/community/coding_guidelines">Coding Guidelines</a></li><li class="menu__list-item"><a class="menu__link" href="/community/reporting_issues">Reporting Issues</a></li><li class="menu__list-item"><a class="menu__link" href="/community/community_sync_up">Community Syncup</a></li><li class="menu__list-item"><a class="menu__link" href="/community/sessions">Sessions and Demos</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="/apache">Apache</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link">Apache Software Foundation</a></li><li class="menu__list-item"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link">Apache Incubator</a></li><li class="menu__list-item"><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="menu__link">Apache License</a></li><li class="menu__list-item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="menu__link">Sponsorship</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" href="/docs">Docs</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/next/">Master</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/">0.8.0</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Get Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/">Get Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/get_started/core_features">Features</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/user_guide/setup_queue_hierarchy">Setup Queue Hierarchy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/user_guide/queue_config">Partition and Queue Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/user_guide/placement_rules">App Placement Rules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/user_guide/sorting_policies">Sorting Policies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/user_guide/acls">ACLs</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Workloads</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/user_guide/workloads/run_spark">Run Spark Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/user_guide/workloads/run_tf">Run Tensorflow Jobs</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/user_guide/trouble_shooting">Trouble Shooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Performance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/performance/evaluate_perf_function_with_kubemark">Evaluate YuniKorn function &amp; performance with Kubemark</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/performance/metrics">Scheduler Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/performance/profiling">Profiling</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/developer_guide/env_setup">Dev Environment Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/developer_guide/build">Build</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/developer_guide/deployment">Deploy to Kubernetes</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Design</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/next/design/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/design/scheduler_core_design">Scheduler Core Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/design/cross_queue_preemption">Cross Queue Preemption</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/design/namespace_resource_quota">Namespace Resource Quota</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/design/pluggable_app_management">Pluggable App Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/design/resilience">Resilience</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/design/predicates">Support K8s Predicates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/design/scheduler_configuration">Scheduler Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/design/state_aware_scheduling">Batch Workloads Ordering with StateAware Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/design/scheduler_object_states">Scheduler Object States</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Apache YuniKorn <strong>next</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/docs">latest version</a></strong>.</div></div><div class="docItemContainer_2cwg"><article><div><span class="badge badge--secondary">Version: next</span></div><header><h1 class="docTitle_1vWb">Architecture</h1></header><div class="markdown"><p>Apache YuniKorn (Incubating) is a light-weight, universal resource scheduler for container orchestrator systems.
It was created to achieve fine-grained resource sharing for various workloads efficiently on a large scale, multi-tenant,
and cloud-native environment. YuniKorn brings a unified, cross-platform, scheduling experience for mixed workloads that
consist of stateless batch workloads and stateful services.</p><p>YuniKorn now supports K8s and can be deployed as a custom K8s scheduler. YuniKorn&#x27;s architecture design also allows
adding different shim layer and adopt to different ResourceManager implementation including Apache Hadoop YARN,
or any other systems.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="architecture"></a>Architecture<a aria-hidden="true" tabindex="-1" class="hash-link" href="#architecture" title="Direct link to heading">#</a></h2><p>Following chart illustrates the high-level architecture of YuniKorn.</p><p><img src="/img/architecture.png" alt="images"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="components"></a>Components:<a aria-hidden="true" tabindex="-1" class="hash-link" href="#components" title="Direct link to heading">#</a></h2><p><strong>Scheduler API Server</strong>:</p><p>Responsible for communication between RM and Scheduler, which implements scheduler-interface GRPC protocol, or just APIs. (For intra-process communication w/o Serde).</p><p><strong>Scheduler Cache</strong>:</p><p>Caches all data related to scheduler state, such as used resources of each queues, nodes, allocations. Relationship between allocations and nodes, etc.
Should not include temporary data helps with scheduler. For example to-be-preempted allocation candidates. Fair share resource of queues, etc.</p><p><strong>Scheduler Cache Event Handler</strong>:</p><p>Handles all events which needs to update scheduler internal state. So all the write operations will be carefully handled.</p><p><strong>Admin Service</strong></p><p>Handles request from Admin, which can also load configurations from storage and update scheduler policies.</p><p><strong>Scheduler and Preemptor</strong></p><p>Handles Scheduler&#x27;s internal state. (Which is not belong to scheduelr cache), such as internal reservations, etc. Scheduler and preemptor will work together, make scheduling or preemption decisions.</p><p>All allocate/preempt request will be handled by event handler.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      GRPC Protocol</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------------------------------------------------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     +--------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     |Scheduler API Server|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+     +---------+----------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |AdminService |               |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+               |Write Ops                    +----------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+               V                            ++Scheduler       |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |Configurator |      +-------------------+  Allocate       ||   And          |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+      |Cache Event Handler+&lt;-----------------|                |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         +----------&gt; +-------------------+  Preempt        ++Preemptor       |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Update Cfg   Handled by policies                   +----------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                               +  (Stateless)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        +------v--------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        |Scheduler Cache|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        +---------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                +---------------------------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                |--------+ +------+ +----------+ +----------+ |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                ||Node   | |Queue | |Allocation| |Requests  | |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                |--------+ +------+ +----------+ +----------+ |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                +---------------------------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="implementation"></a>Implementation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#implementation" title="Direct link to heading">#</a></h2><p><strong>Scheduler needs to do following responsibilities</strong></p><ul><li>According to resource usages between queues, sort queues, applications, and figure out order of application allocation. (This will be used by preemption as well).</li><li>It is possible that we cannot satisfy some of the allocation request, we need to skip them and find next request.</li><li>It is possible that some allocation request cannot be satisfied because of resource fragmentation. We need to reserve room for such requests.</li><li>Different nodes may belong to different disjoint partitions, we can make independent scheduler runs</li><li>Locality is still important for many scenarios, especially for on-prem cases.</li><li>Be able to config and change ordering policies for apps, queues.</li><li>Application can choose their own way to manage sort of nodes.</li></ul><p><strong>Preemption:</strong></p><ul><li>It is important to know &quot;who wanna the resource&quot;, so we can do preemption based on allocation orders.</li><li>When do preemption, it is also efficient to trigger allocation op. Think about how to do it.</li><li>Preemption needs to take care about queue resource balancing.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configurations--semantics"></a>Configurations &amp; Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configurations--semantics" title="Direct link to heading">#</a></h2><p>Example of configuration:</p><ul><li><p>Partition is name space.</p></li><li><p>Same queues can under different partitions, but enforced to have same hierarchy.</p><p>  Good:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x    partition=y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     a           a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \        / \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c      b   c</span></div></div></div></div></div><p>  Good (c in partition y acl=&quot;&quot;):</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x    partition=y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     a           a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \        /</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c      b</span></div></div></div></div></div><p>  Bad (c in different hierarchy)</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x    partition=y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     a           a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \        /  \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c      b    d</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              /</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             c</span></div></div></div></div></div><p>  Bad (Duplicated c)</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> /</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div></li><li><p>Different hierarchies can be added</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-scheduler-conf.yaml codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">partitions:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - name:  default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    queues:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        root:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          configs:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            acls:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          childrens:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - b</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        a:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          configs:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            acls:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            capacity: (capacity is not allowed to set for root)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            max-capacity: ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      mapping-policies:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: partition_a:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    queues:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        root:...</span></div></div></div></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="flow-of-events"></a>Flow of events<a aria-hidden="true" tabindex="-1" class="hash-link" href="#flow-of-events" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Job Add:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Cache -&gt; Scheduler (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Job Remove:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Released allocations: (Same as normal release) (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Make sure remove from scheduler first to avoid new allocated created. </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduling Request Add:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Cache -&gt; Scheduler (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Will check if requested job exists, queue exists, etc.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">When any request invalid:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Cache -&gt; RM (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Scheduler -&gt; RM (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduling Request remove:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">------------------------- </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Make sure removed from scheduler first to avoid new container allocated</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Allocation remove (Preemption) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduler -&gt; Cache -&gt; RM (TODO)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              (confirmation)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Allocation remove (RM voluntarilly ask)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">---------------------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache -&gt; RM. (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      (confirmation)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Node Add: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">---------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Cache -&gt; Scheduler (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Inside Cache, update allocated resources.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error handling: Reject Node to RM (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Node Remove: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Implemented in cache side</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache (TODO)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Allocation Proposal:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduler -&gt; Cache -&gt; RM</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">When rejected/accepted:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Cache -&gt; Scheduler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Initial: (TODO)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1. Admin configured partitions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2. Cache initializes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3. Scheduler copies configurations</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Relations between Entities </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1. RM includes one or multiple:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Partitions </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Jobs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Nodes </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Queues</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2. One queue: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one partition</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one RM.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3. One job: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one queue (Job with same name can under different partitions)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one partition</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM registration: (TODO)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">----------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1. RM send registration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2. If RM already registered, remove old one, including everything belong to RM.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM termination (TODO) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Just remove the old one.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Update of queues (TODO) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Admin Service -&gt; Cache</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">About partition (TODO) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Internal partition need to be normalized, for example, RM specify node with partition = xyz. </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduler internally need to normalize it to &lt;rm-id&gt;_xyz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">This need to be done by RMProxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/next/developer_guide/deployment"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Deploy to Kubernetes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/next/design/scheduler_core_design"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Scheduler Core Design »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#architecture" class="table-of-contents__link">Architecture</a></li><li><a href="#components" class="table-of-contents__link">Components:</a></li><li><a href="#implementation" class="table-of-contents__link">Implementation</a></li><li><a href="#configurations--semantics" class="table-of-contents__link">Configurations &amp; Semantics</a></li><li><a href="#flow-of-events" class="table-of-contents__link">Flow of events</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Blog</h4><ul class="footer__items"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s YuniKorn?</a></li><li class="footer__item"><a href="https://blog.cloudera.com/apache-yunikorn-incubating-0-8-release-whats-new-and-upcoming/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s new in YuniKorn 0.8.0?</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Github</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-core</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item">kubernetes-shim</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-interface</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-web</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="http://yunikorn.apache.org/community/community_sync_up" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community meetings</a></li><li class="footer__item"><a href="http://people.apache.org/phonebook.html?podling=yunikorn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roster</a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1Wg7"><img class="footer__logo" alt="Apache Incubator Logo" src="https://incubator.apache.org/images/apache-incubator-logo-source.svg"></a></div><div>Copyright © 2020 The Apache Software Foundation.</div></div></div></footer></div>
<script src="/styles.957e58f8.js"></script>
<script src="/runtime~main.53125f3e.js"></script>
<script src="/main.43dd4139.js"></script>
<script src="/1.32497331.js"></script>
<script src="/2.ecf8b154.js"></script>
<script src="/3.82db307e.js"></script>
<script src="/1be78505.1e00729c.js"></script>
<script src="/78.ec6dfba6.js"></script>
<script src="/c6c6e257.77e2123c.js"></script>
<script src="/17896441.aa30516a.js"></script>
<script src="/64a11ff0.7384874c.js"></script>
</body>
</html>